<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Empresas</h2>
    <button class="btn btn-primary" routerLink="/empresas/novo">Nova Empresa</button>
  </div>

  <div *ngIf="loading" class="text-center">
    <app-loading></app-loading>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="!loading && empresas.length === 0" class="alert alert-info">
    Nenhuma empresa cadastrada.
  </div>

  <div class="table-responsive">
    <table *ngIf="!loading && empresas.length > 0" class="table table-striped table-hover">
      <thead class="table-primary">
        <tr>
          <th>CNPJ</th>
          <th>Nome Fantasia</th>
          <th>CEP</th>
          <th>Fornecedores</th>
          <th class="text-center">Ações</th>
        </tr>
      </thead>
      <tbody>
        <ng-container *ngFor="let empresa of empresas; let i = index">
          <tr *ngIf="!empresa.editMode">
            <td>{{ empresa.cnpj }}</td>
            <td>{{ empresa.nomeFantasia }}</td>
            <td>{{ empresa.cep }}</td>
            <td>{{ empresa.fornecedores?.length || 0 }}</td>
            <td class="text-center">
              <div class="btn-group">
                <button class="btn btn-sm btn-info me-1" [routerLink]="['/empresas', empresa.id]" title="Detalhes">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-sm btn-warning me-1" (click)="toggleEditMode(empresa)" title="Editar">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-danger" (click)="deleteEmpresa(empresa.id)" title="Excluir">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>

          <tr *ngIf="empresa.editMode">
            <td>
              <input type="text" [(ngModel)]="empresa.cnpj" class="form-control form-control-sm" [appCnpjMask]="true"/>
            </td>
            <td>
              <input type="text" [(ngModel)]="empresa.nomeFantasia" class="form-control form-control-sm" />
            </td>
            <td>
              <input type="text" [(ngModel)]="empresa.cep" class="form-control form-control-sm" appCepMask />
            </td>
            <td>{{ empresa.fornecedores?.length || 0 }}</td>
            <td class="text-center">
              <div class="btn-group">
                <button class="btn btn-sm btn-success me-1" (click)="saveInlineEdit(empresa)" title="Salvar">
                  <i class="fas fa-save"></i>
                </button>
                <button class="btn btn-sm btn-secondary" (click)="cancelEdit(empresa, i)" title="Cancelar">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </td>
          </tr>
        </ng-container>
      </tbody>
    </table>
  </div>
</div>
